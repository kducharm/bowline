#!/usr/bin/env bash

source $(dirname $0)/../lib/bowline/bowline
assert_proxy

echo "# STARTING CONTAINERS"
if [ "$BOWLINE_FILESYNC" == "docker-sync" ]; then
  docker_sync_init
  docker-sync start
fi

$DCOMPOSE stop web php
$DCOMPOSE rm --force web php
$DCOMPOSE up -d --no-recreate

EXIT=$?
echo -e "\033[m Exit Status: $EXIT"

# Connect network manually if not connected
if [ ! "$(docker inspect proxy | grep ${BOWLINE}_default)" ];then
  echo "Connecting network ${BOWLINE}_default to proxy..."
  docker network connect ${BOWLINE}_default proxy
fi

bowline
exit $EXIT
